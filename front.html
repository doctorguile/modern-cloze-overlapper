<template id="anki-cloze">{{cloze:Text}}</template>
<template id="cloze-config">{{Before|After|OnlyContext|RevelAll|InactiveHints}}</template>
<template id="cloze-source">
	<!--
    Uncomment and adjust if MathJax style autodetection doesn't work for you.
    <div style="display: none">
      \[
        \renewcommand\AnkiClozeQ[1]{\mathbf{\color{blue} #1}}
        \renewcommand\AnkiClozeA[1]{\AnkiClozeQ{#1}}
      \]
    </div>
  -->
  {{Text}}
</template>
<div id="rendered-cloze"></div>

<script>
  // anki-export-media: "_cloze-overlapper.mjs"
  (() => {
      'use strict';

      const CLOZE_CONTAINER = document.getElementById('rendered-cloze');

      function reportError(e) {
          CLOZE_CONTAINER.textContent = e;
      }

      async function renderClozes() {
          try {
              // https://github.com/ankidroid/Anki-Android/pull/7764
              const mediaRoot = globalThis.AnkiDroidJS
                              ? 'https://appassets.androidplatform.net'
                              : globalThis.ankiPlatform === 'desktop' ? '' : '.';
              const ClozeOverlapper = await import(`${mediaRoot}/_cloze-overlapper.mjs`);
              await ClozeOverlapper.renderClozes();
          } catch (e) {
              reportError(e);
          }
      }

      try {
          try {
              require('anki/reviewer').onUpdateHook.push(renderClozes);
          } catch (e) {
              if (!e?.message.includes('Cannot require')) {
                  throw e;
              }
              onUpdateHook.push(renderClozes);
          }
      } catch (e) {
          reportError(e);
      }
  })();
</script>
